Tl;dr: Create a telegram bot adding songs to a Google Play Music playlist based on received messages.

This repository uses the [python telegram bot api](https://python-telegram-bot.org/) as well as [gmusicapi](https://github.com/simon-weber/gmusicapi). Once the bot is created, a message will directly be turned to a search query on google play music. The highest ranking result-song will then be added to a playlist called 'autogenerated'.

Access to the bot can be restricted by filtering on usernames. This is a key feature of the bot: it allows you to share the bot with your friends so they can add song to the playlist for you to explore.

`bot.py` can be run locally, to test the setup. You will need a telegram token and write it to the `TELEGRAM_TOKEN` variable in a file called `app_secrets.py`. See comments in `bot.py` for first-time authentication with google play music. When authenticating for the first time via, `api.perform_oauth()`, you will be led to your browser and receive a key. I refered to this key as `GMUSIC_LOGIN` and also placed it in `app_secrets.py`.

`main.py` contains the music management methods and is written in a format as to be plugged into Google Cloud Functions directly. The function to be submitted is `webhook`. In comparison to `bot.py`, this does not rely on continuous polling but rather on a webhook. Moreover, `bot.py` will require you to set some envrionment variables.
  * `GMUSIC_LOGIN` is, again, the key received through the browser authentication
  * `REFRESH_TOKEN`, `CLIENT_ID`, `CLIENT_SECRET` can be found in the credentials file created in the process of authenticating for the first time

The latter is supposed to be called `mobileclient.cred` and could be found under `~/.local/share/gmusicapi/` on my system.

In order to deploy `main.py` on Google fugnctions, the only further step required is to 'activate' the webhook:
`curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://<YOUR_SERVER_REGION>-<YOUR_PROJECT_NAME>.cloudfunctions.net/<YOUR_GC_FUNCTION_NAME>"`

Many thanks to [Simon Weber](https://www.simonmweber.com/) for providing help regarding the authentication and his work on gmusicapi in general!